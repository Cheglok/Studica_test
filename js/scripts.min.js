"use strict";(function(){const b="https://studika.ru/api/areas";let e=[],t=[],n=[],o=document.querySelector(".location__list"),i=document.querySelector(".modal"),r=document.querySelector(".selected-locations"),u=document.querySelector(".available-locations"),k=document.querySelector(".loader"),h=document.querySelector(".location-form__search-input"),f=document.querySelector(".clear-icon"),d=document.querySelector(".location-form__button"),g=document.querySelector("#location-template").content.querySelector(".available-location__item"),nt=document.querySelector("#location-template").content.querySelector(".selected-locations__item");const tt=async function(n){const t=await fetch(n,{method:"POST"});return t.json()},it=async function(n){const t=await fetch("https://httpbin.org/post",{method:"POST",headers:{"Content-Type":"application/json"},body:n});return t.json()},rt=function(n){let t=g.cloneNode(!0);return t.dataset.locationId=n.id,t.querySelector(".available-location__item-name").innerHTML=n.name,n.state_name&&(t.querySelector(".available-location__item-region").textContent=n.state_name,t.querySelector(".available-location__item-region").style.display="block"),t},c=function(n,t){let i=nt.cloneNode(!0);return i.dataset.id=n,i.dataset.name=t,i.querySelector(".selected-location__item-name").textContent=t,r.appendChild(i),i},ut=function(){if(n.length){let t=[];n.forEach(n=>{t.push(n.name)});o.textContent=t.join(", ")}else o.textContent="Любой регион"},l=function(t,i,r){r?n.push({id:t,name:i}):n=n.filter(n=>n.name!==i);ut()},a=function(n){n.preventDefault();n.stopPropagation();let t=n.currentTarget.parentNode,i=t.dataset.id,r=t.dataset.name,f=u.querySelector(`.available-location__item[data-location-id="${i}"]`);v(f,i,r)},ft=function(n,t,i){n.classList.add("available-location__item_selected");let r=c(t,i);r.querySelector(".close-icon").addEventListener("click",a);l(t,i,!0)},v=function(n,t,i){n.classList.remove("available-location__item_selected");r.querySelector(`.selected-locations__item[data-id="${t}"]`).remove();l(t,i,!1)},et=function(n){let t=n.currentTarget.dataset.locationId,i=n.currentTarget.querySelector(".available-location__item-name").textContent;n.currentTarget.classList.contains("available-location__item_selected")?v(n.currentTarget,t,i):ft(n.currentTarget,t,i)},ot=function(){let n=document.querySelectorAll(".available-location__item");n.forEach(n=>{n.addEventListener("click",et)})},y=function(n){let i=new RegExp(n,"i"),r=t.slice(),u=r.filter(t=>t.name.toLowerCase().includes(n)),f=u.map(n=>{let t={};return t.name=n.name.replace(i,'<span class="searched-substring">$&<\/span>'),t.id=n.id,t.state_name=n.state_name,t});p(f)},st=function(n){n.length?f.classList.remove("visually-hidden"):f.classList.add("visually-hidden")},ht=function(){let t=JSON.stringify(n);document.cookie="selected="+t;it(t).then(()=>alert("Успешно сохранено на сервере"))},ct=function(){h.addEventListener("input",function(n){st(n.target.value);y(n.target.value.toLowerCase())});f.addEventListener("click",function(){h.value="";y("");f.classList.add("visually-hidden")});d.addEventListener("click",ht)},lt=function(){e.forEach(n=>{t.push(n),n.type&&n.cities&&n.cities.forEach(i=>{i.state_name=n.name,t.push(i)})})},at=function(){r.innerHTML="";n.forEach(n=>{let t=document.querySelector(`.available-location__item[data-location-id="${n.id}"]`);t&&t.classList.add("available-location__item_selected");let i=c(n.id,n.name);i.querySelector(".close-icon").addEventListener("click",a)})},p=function(n){u.innerHTML="";let r=n?n:t,i=document.createDocumentFragment();r.forEach(n=>{i.appendChild(rt(n))});u.appendChild(i);at();ot()},w=function(){t.length||(lt(),p(),ct());r.classList.remove("visually-hidden");u.classList.remove("visually-hidden");k.classList.add("visually-hidden")},s=function(n){n.target.closest(".modal")||(i.classList.add("visually-hidden"),i.classList.remove("modal-animated"),document.removeEventListener("click",s))},vt=function(){let t=document.cookie.match(new RegExp("(?:^|; )selected=([^;]*)")),i=t?JSON.parse(t[1]):undefined;i&&(n=i)},yt=function(){i.classList.remove("visually-hidden");i.classList.add("modal-animated");document.addEventListener("click",s);e.length?w():tt(b).then(n=>{e=n,vt(),w()})},pt=function(n){n.stopPropagation();i.classList.contains("visually-hidden")?yt():s(n)};o.addEventListener("click",pt)})();
